{% extends 'costos/base.html' %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% block meta_desc %} A&B Cost {% endblock %}
{% block title %} A&B Cost - {{ receta.name }}  Steps {% endblock %}
{%block content %}
    <style>
        .steps_form{
            border-bottom: 1px solid black;
        }
        .hidden{
            display:none
        }
    </style>
    {% if message %}
    <p>{{ message}}</p>
    {% endif %}
    <div style="margin-top:30px" >
    <form action="" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {% for field in form %}
        <div class="{% if field.field.required %}{{form.required_css_class}}{%endif%}">
            {{ field.errors }}
            {{ field.label_tag }}{{ field }}
            {% if field.hel_text %}
                <p class="help">{{ field.help_text | safe }}</p>
            {% endif %}
        </div>
        {% endfor %}

        {% if formset %}
        <h3>Steps</h3>
        {{ formset.management_form }}
        <div id="steps-form-list">
        {% for form in formset %}
            <div class="steps-form">
                {{ form }}
            </div>
            {% endfor %}
        </div>
        <div id="empty-form" class="">{{formset.empty_form }}</div>
        <button id="add-more" class="d-none d-sm-inline-block btn-sm btn-secondary w-20 shadow-sm" type="button"> + </button>
        {% endif %}
        <hr>
        <button type="submit" class="btn btn-primary w-100 mb-2">Save</button>
    </form>
    </div>
    <script>

        const addMoreBtn = document.getElementById('add-more')
        const totalNewForms = document.getElementById('steps_receta-TOTAL_FORMS')

        addMoreBtn.addEventListener('click',add_new_form)
        function add_new_form(event){
            if (event){
                event.preventDefault()
            }
            const currentStepsForms = document.getElementsByClassName('steps-form')
            const currentFormCount = currentStepsForms.length
            const formCopyTarget = document.getElementById('steps-form-list')
            const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true)
            copyEmptyFormEl.setAttribute('class','steps-form')
            copyEmptyFormEl.setAttribute('id','')
            formCopyTarget.append(copyEmptyFormEl)
        }

    </script>
{% endblock %}}